{"ast":null,"code":"import * as Realm from \"realm-web\";\nimport { addUser } from '../../service';\nimport { app } from '../../service/mongoDB-sdk';\nimport { handleLogin, handleLogout, handleAuthenticationErrors } from '../../state/actions/authentication';\n\nconst useAuthentication = dispatch => {\n  function handleUserRegistration(newUser) {\n    const userProfile = {\n      first: newUser.first,\n      last: newUser.last,\n      email: newUser.email,\n      city: newUser.city,\n      country: n\n    };\n    return new Promise(resolve => {\n      app.emailPasswordAuth.registerUser(newUser.email, newUser.password).then(() => {\n        const credentials = Realm.Credentials.emailPassword(newUser.email, newUser.password);\n        app.logIn(credentials).then(user => {\n          addUser(newUser);\n          resolve(user);\n          dispatch(handleLogin(newUser));\n        });\n      }).catch(err => dispatch(handleAuthenticationErrors(err)));\n    });\n  }\n\n  async function handleUserLogout() {\n    var _app$currentUser;\n\n    console.log(app.currentUser);\n    (_app$currentUser = app.currentUser) === null || _app$currentUser === void 0 ? void 0 : _app$currentUser.logOut().then(() => console.log(\"user successfully log out\")).catch(err => console.log(err));\n  }\n\n  async function handleUserLogin(email, password) {\n    return new Promise(resolve => {\n      app.logIn(Realm.Credentials.emailPassword(email, password)).then(async () => {\n        //verify user profile\n        const currentUser = await app.currentUser;\n        resolve(currentUser);\n        dispatch(handleLogin(currentUser)); // retrieve user profile\n        // getUser(currentUser.email)\n        // .then(userProfile => {\n        //   dispatch(handleLogin(userProfile))\n        //  resolve(currentUser)\n        // })\n      }).catch(err => dispatch(handleAuthenticationErrors(err)));\n    });\n  }\n\n  async function handleAuthentication() {\n    const currentUser = await app.currentUser;\n    dispatch(handleLogin(currentUser)); // getUser(currentUser?.email)\n    // .then(userProfile => !!currentUser && dispatch(handleLogin(userProfile)))\n    // .catch(err => dispatch(handleAuthenticationErrors(err)))\n  }\n\n  return {\n    handleUserRegistration,\n    handleUserLogout,\n    handleUserLogin,\n    handleAuthentication\n  };\n};\n\nexport default useAuthentication;","map":{"version":3,"sources":["/media/haddad/6a8a543b-c57b-47b0-a06e-396959f42841/sandra-udemy/marketplace/client/src/lib/hooks/useAuthentication/index.js"],"names":["Realm","addUser","app","handleLogin","handleLogout","handleAuthenticationErrors","useAuthentication","dispatch","handleUserRegistration","newUser","userProfile","first","last","email","city","country","n","Promise","resolve","emailPasswordAuth","registerUser","password","then","credentials","Credentials","emailPassword","logIn","user","catch","err","handleUserLogout","console","log","currentUser","logOut","handleUserLogin","handleAuthentication"],"mappings":"AAAA,OAAO,KAAKA,KAAZ,MAAuB,WAAvB;AACA,SAAQC,OAAR,QAAsB,eAAtB;AACA,SAAQC,GAAR,QAAkB,2BAAlB;AACA,SACIC,WADJ,EAEIC,YAFJ,EAGIC,0BAHJ,QAIO,oCAJP;;AAMA,MAAMC,iBAAiB,GAAKC,QAAD,IAAc;AACrC,WAASC,sBAAT,CAAgCC,OAAhC,EAAyC;AACrC,UAAMC,WAAW,GAAE;AACfC,MAAAA,KAAK,EAAEF,OAAO,CAACE,KADA;AAEfC,MAAAA,IAAI,EAAEH,OAAO,CAACG,IAFC;AAGfC,MAAAA,KAAK,EAACJ,OAAO,CAACI,KAHC;AAIfC,MAAAA,IAAI,EAAEL,OAAO,CAACK,IAJC;AAKfC,MAAAA,OAAO,EAACC;AALO,KAAnB;AAOA,WAAO,IAAIC,OAAJ,CAAaC,OAAD,IAAa;AAC5BhB,MAAAA,GAAG,CAACiB,iBAAJ,CACCC,YADD,CACcX,OAAO,CAACI,KADtB,EAC6BJ,OAAO,CAACY,QADrC,EAECC,IAFD,CAEM,MAAM;AACV,cAAMC,WAAW,GAAGvB,KAAK,CAACwB,WAAN,CAAkBC,aAAlB,CAChBhB,OAAO,CAACI,KADQ,EAEhBJ,OAAO,CAACY,QAFQ,CAApB;AAIEnB,QAAAA,GAAG,CAACwB,KAAJ,CAAUH,WAAV,EAAuBD,IAAvB,CAA6BK,IAAD,IAAU;AAClC1B,UAAAA,OAAO,CAACQ,OAAD,CAAP;AACAS,UAAAA,OAAO,CAACS,IAAD,CAAP;AACApB,UAAAA,QAAQ,CAACJ,WAAW,CAACM,OAAD,CAAZ,CAAR;AACH,SAJD;AAKH,OAZD,EAaCmB,KAbD,CAaOC,GAAG,IAAItB,QAAQ,CAACF,0BAA0B,CAACwB,GAAD,CAA3B,CAbtB;AAcH,KAfM,CAAP;AAgBH;;AACD,iBAAeC,gBAAf,GAAkC;AAAA;;AAC9BC,IAAAA,OAAO,CAACC,GAAR,CAAY9B,GAAG,CAAC+B,WAAhB;AACA,wBAAA/B,GAAG,CAAC+B,WAAJ,sEACEC,MADF,GAECZ,IAFD,CAEM,MAAMS,OAAO,CAACC,GAAR,CAAY,2BAAZ,CAFZ,EAGCJ,KAHD,CAGQC,GAAD,IAASE,OAAO,CAACC,GAAR,CAAYH,GAAZ,CAHhB;AAIH;;AACL,iBAAeM,eAAf,CAA+BtB,KAA/B,EAAsCQ,QAAtC,EAAgD;AAC/C,WAAO,IAAIJ,OAAJ,CAAaC,OAAD,IAAa;AAC5BhB,MAAAA,GAAG,CACFwB,KADD,CACO1B,KAAK,CAACwB,WAAN,CAAkBC,aAAlB,CAAgCZ,KAAhC,EAAuCQ,QAAvC,CADP,EAECC,IAFD,CAEM,YAAY;AACd;AACA,cAAMW,WAAW,GAAG,MAAM/B,GAAG,CAAC+B,WAA9B;AACAf,QAAAA,OAAO,CAACe,WAAD,CAAP;AACA1B,QAAAA,QAAQ,CAACJ,WAAW,CAAC8B,WAAD,CAAZ,CAAR,CAJc,CAKd;AACD;AACA;AACE;AACC;AACH;AACF,OAbD,EAcCL,KAdD,CAcQC,GAAD,IAAQtB,QAAQ,CAACF,0BAA0B,CAACwB,GAAD,CAA3B,CAdvB;AAeH,KAhBM,CAAP;AAiBA;;AAED,iBAAeO,oBAAf,GAAsC;AAClC,UAAMH,WAAW,GAAG,MAAM/B,GAAG,CAAC+B,WAA9B;AACA1B,IAAAA,QAAQ,CAACJ,WAAW,CAAC8B,WAAD,CAAZ,CAAR,CAFkC,CAGnC;AACA;AACA;AACF;;AACG,SAAO;AACHzB,IAAAA,sBADG;AAEHsB,IAAAA,gBAFG;AAGHK,IAAAA,eAHG;AAIHC,IAAAA;AAJG,GAAP;AAMH,CAlED;;AAoEA,eAAe9B,iBAAf","sourcesContent":["import * as Realm from \"realm-web\";\nimport {addUser} from '../../service';\nimport {app} from '../../service/mongoDB-sdk';\nimport {\n    handleLogin,\n    handleLogout,\n    handleAuthenticationErrors\n} from '../../state/actions/authentication'\n\nconst useAuthentication =  (dispatch) => {\n    function handleUserRegistration(newUser) {\n        const userProfile= {\n            first: newUser.first,\n            last: newUser.last,\n            email:newUser.email,\n            city: newUser.city,\n            country:n\n        }\n        return new Promise((resolve) => {\n            app.emailPasswordAuth\n            .registerUser(newUser.email, newUser.password)\n            .then(() => {\n              const credentials = Realm.Credentials.emailPassword(\n                  newUser.email, \n                  newUser.password\n                  );\n                app.logIn(credentials).then((user) => {\n                    addUser(newUser);\n                    resolve(user);\n                    dispatch(handleLogin(newUser));\n                });\n            })\n            .catch(err => dispatch(handleAuthenticationErrors(err)));\n        });\n    }\n    async function handleUserLogout() {\n        console.log(app.currentUser);\n        app.currentUser\n        ?.logOut()\n        .then(() => console.log(\"user successfully log out\"))\n        .catch((err) => console.log(err));\n    }\nasync function handleUserLogin(email, password) {\n return new Promise((resolve) => {\n     app\n     .logIn(Realm.Credentials.emailPassword(email, password))\n     .then(async () => {\n         //verify user profile\n         const currentUser = await app.currentUser;\n         resolve(currentUser);\n         dispatch(handleLogin(currentUser));\n         // retrieve user profile\n        // getUser(currentUser.email)\n        // .then(userProfile => {\n          //   dispatch(handleLogin(userProfile))\n           //  resolve(currentUser)\n        // })\n     })\n     .catch((err) =>dispatch(handleAuthenticationErrors(err)));\n });\n}\n\nasync function handleAuthentication() {\n    const currentUser = await app.currentUser;\n    dispatch(handleLogin(currentUser));\n   // getUser(currentUser?.email)\n   // .then(userProfile => !!currentUser && dispatch(handleLogin(userProfile)))\n   // .catch(err => dispatch(handleAuthenticationErrors(err)))\n}\n    return {\n        handleUserRegistration,\n        handleUserLogout,\n        handleUserLogin,\n        handleAuthentication\n    };\n};\n\nexport default useAuthentication;"]},"metadata":{},"sourceType":"module"}